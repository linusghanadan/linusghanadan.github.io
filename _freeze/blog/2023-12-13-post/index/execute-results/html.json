{
  "hash": "cc4e3242ffd9ce2687cbbf4aefb9c562",
  "result": {
    "markdown": "---\ntitle: \"Reproducible workflow to gauge suitability of species for U.S. West Coast marine aquaculture\"\ndescription: \"This analysis starts by assessing the suitability of oyster aquaculture in U.S. West Coast Exclusive Economic Zones. Then, a generalized model that provides total and percent area of suitability for any species based on input ranges of suitable temperature and depth.\"\nauthor: \n  - name: Linus Ghanadan\n    url: https://linusghanadan.github.io/\n    affiliation: MEDS\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 12-12-2023\ncategories:\n  - [Geospatial Analysis]\n  - [Aquaculture]\n  - [R]\nbibliography: 223_blog.bib\ncitation:\n  url: https://linusghanadan.github.io/blog/2023-12-13-post/\nimage: fish_farm.jpeg\nsidebar:\n    title: \"Outline\"\ndraft: false\nformat:\n    html:\n        code-fold: true\n---\n\n\n## Purpose\n\nMarine aquaculture has the potential to be an important solution to meet the future demand for protein-rich food while simultaneously ensuring environmental sustainability [@costello_future_2020]. Increases in the demand for seafood have already resulted in an industry shift from wild fisheries to terrestrial aquaculture, with farmed seafood products currently making up about 50% of the global seafood supply. However, concerns about the sustainability of further expanding terrestrial aquaculture suggest that increasing the development of marine aquaculture farms might play a substantial role in a comprehensive solution.\n\nFurthermore, the U.S. West Coast represents an area where such marine aquaculture expansion could take place. In fact, the State of Washington currently leads the nation in marine aquaculture development. From 2005 to 2018, Washington generated over \\$200 million from these sea-based farms, about 40% of nationwide revenue during that same period [@froehlich_piecing_2022].\n\nThis analysis seeks to build on knowledge regarding the potential for marine aquaculture expansion in the four Exclusive Economic Zones (EEZs) adjacent to the U.S. West Coast. Using raster data on mean sea surface temperature and depth, I'll estimate the total and percent area within each of these four EEZs that would be suitable for oyster aquaculture. After visualizing oyster suitability, I'll create a generalized model that can be used for any species based on their ideal temperature and depth ranges.\n\n## Load required R packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(sf)\nlibrary(terra)\nlibrary(here)\nlibrary(dplyr)\nlibrary(raster)\nlibrary(tmap)\nlibrary(spData)\n```\n:::\n\n\n## Read in data\n\n#### Sea surface temperature TIF files\n\nFor temperature, we will use a stacked 1 km by 1 km gridded raster with data collected by the National Oceanic and Atmospheric Association [@national_oceanic_and_atmospheric_association_noaa_daily_2018]. There are a total of five layers, one for each year from 2008 through 2012. The values in each grid cell correspond to the area's mean sea surface temperature for that year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Store list of SST tif files\nsst_files <- list.files(here(\"data/2023-12-13-post-data\"), pattern = \"\\\\d\\\\.tif$\", full.names = TRUE)\n\n# Store first raster to use as reference raster\nreference_raster <- raster(sst_files[1])\n\n# Create an empty list\nsst_processed <- list()\n\n# Loop through each raster file\nfor (file in sst_files) {\n  # Read the raster\n  r <- raster(file)\n  # Resample the raster using the reference raster\n  r_resampled <- resample(r, reference_raster)\n  # Crop the raster using the extent of reference raster\n  r_cropped <- crop(r_resampled, extent(reference_raster))\n  # Add the processed raster to the list\n  sst_processed[[file]] <- r_cropped\n}\n\n# Stack the processed rasters\nsst_stacked <- stack(sst_processed)\n\n# Create new SST raster for mean SST from 2008 to 2012\nmean_sst <- mean(sst_stacked, na.rm = TRUE)\n\n# Convert SST data from Kelvin to Celsius\nmean_sst <- mean_sst - 273.15\n```\n:::\n\n\n#### Bathymetry raster\n\nThe bathymetry raster that we will be using characterizes ocean depth at a spatial resolution of one meter grid cells. We get this data from the General Bathymetric Chart of the Oceans [@general_bathymetric_chart_of_the_oceans_gebco_gridded_2023].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load bathymetry raster\ndepth <- raster(here(\"data/2023-12-13-post-data/depth.tif\"))\n\n# Resample the depth data to match the resolution of SST data\ndepth <- resample(depth, mean_sst, method = \"ngb\")\n```\n:::\n\n\n#### Shapefile for West Coast EEZs\n\nThis data comes from Marine Regions, which is managed by the Flanders Marine Institute [@marine_regions_eez_nodate].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load shapefile for West Coast EEZ\neez <- st_read(here(\"data/2023-12-13-post-data/wc_regions_clean.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `wc_regions_clean' from data source \n  `/Users/linusghanadan/Documents/MEDS/other/linusghanadan.github.io/data/2023-12-13-post-data/wc_regions_clean.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -129.1635 ymin: 30.542 xmax: -117.097 ymax: 49.00031\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\n## Oyster suitability analysis\n\nNow that we have processed the data, we can move on to figuring out where oyster aquaculture is suitable in West Coast EEZs. Oysters generally reside in waters with a sea surface temperature of 11 to 30 degrees Celsius and at a depth of 0 to 70 meters below sea level [@froese_fishbase_2023]. Thus, we will use these ranges to build a suitability raster and then crop to only include areas in West Coast EEZs.\n\n#### Create and crop suitability mask\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make binary raster with values of 1 where SST is 11-30 degrees Celsius (otherwise NA)\nrcl = matrix(c(-Inf, 11, NA,\n                 11, 30, 1, \n                 30, Inf, NA), ncol = 3, byrow = TRUE)\nsst_binary <- reclassify(mean_sst, rcl = rcl)\n\n# Make binary raster with values of 1 where depth is 0-70 meters below sea level (otherwise NA)\nrcl = matrix(c(-Inf, 0, NA,\n                 0, 70, 1, \n                 70, Inf, NA), ncol = 3, byrow = TRUE)\ndepth_binary <- reclassify(depth, rcl = rcl)\n\n\n# Multiply cell values in both binary rasters to create mask raster of suitable locations for oysters \noyster_mask <- overlay(sst_binary, depth_binary, fun = '*')\n\n# Crop mask based on EEZ data\noyster_mask <- crop(oyster_mask, eez)\n```\n:::\n\n\n#### Create cell areas raster and EEZ raster\n\nNext, we calculate the total number of cells that are suitable. In this case, this is equivalent to the cell areas in meters squared, as the grid cell resolution is one meter by one meter. We also convert the cell areas data and EEZ area data to raster form, so we can perform our calculation in the next step.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate total number of cells that are suitable\ncell_areas <- cellStats(oyster_mask, stat = \"sum\", na.rm = TRUE)\n\n# Create raster for cell areas and populate\ncell_areas_raster <- raster(oyster_mask)\ncell_areas_raster[] <- cell_areas\n\n# Convert EEZ data to raster\neez_raster <- rasterize(eez, oyster_mask)\n```\n:::\n\n\n#### Calculate total and percent suitable area for each EEZ\n\nTo calculate total and percent suitable area for each EEZ, we use the *zonal()* function from the raster package in R. This function allows us to calculate the sum of suitable grid cells within each EEZ, as our EEZ raster labels each grid cell as part of one of the five West Coast EEZs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate total suitable area within each EEZ\ntotal_suitable_area <- raster::zonal(cell_areas_raster, eez_raster, fun = sum, na.rm = TRUE)\n\n# Calculate percentage of suitable area within each EEZ\npercent_suitable_area <- (total_suitable_area / eez$area_m2) * 100\n```\n:::\n\n\n#### Visualize results\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bind EEZ data with total area and percent calculations\neez_joined <- cbind(eez, total_suitable_area, percent_suitable_area) %>%\n  mutate(\"Suitable area (km^2)\" = value / 1000000) %>%\n  mutate(\"Percent suitable\" = value.1) %>% \n  dplyr::select(-value, -value.1, -zone, -zone.1)\n\n# Store polygons for U.S. West Coast States from spData package\nCA <- us_states %>%\n  filter(NAME == \"California\")\nOR <- us_states %>%\n  filter(NAME == \"Oregon\")\nWA <- us_states %>%\n  filter(NAME == \"Washington\")\n\n# Initialize new bbox using EEZ bbox\nbbox_new <- st_bbox(eez)\n\n# Create variable for x range of bbox\nxrange <- bbox_new$xmax - bbox_new$xmin\n\n# Set new x range for bbox\nbbox_new[3] <- bbox_new[3] + (0.9 * xrange)\n\n# Convert bbox to sfc\nbbox_new <- bbox_new %>%\n  st_as_sfc()\n\n# Create plot of total suitable area for oysters in U.S. West Coast EEZs\ntotal_area_map <- \n  tm_shape(eez_joined, bbox = bbox_new) +\n  tm_fill(\"Suitable area (km^2)\", palette=\"Reds\", style = \"equal\", n=6) +\n  tm_borders() +\n  tm_shape(CA) +\n  tm_borders() +\n  tm_shape(OR) +\n  tm_borders() +\n  tm_shape(WA) +\n  tm_borders() +\n  tm_compass(position = c(\"left\", \"bottom\")) +\n  tm_scale_bar(position = c(\"left\", \"bottom\")) +\n  tm_layout(title = \"Suitable area for oyster aquaculture\") +\n  tm_layout(legend.position = c(\"right\", \"center\")) +\n  tm_layout(inner.margins = 0.15)\n\n# Create plot of percent suitable area for oysters in U.S. West Coast EEZs\ntmap_mode(\"plot\")\npercent_area_map <- \n  tm_shape(eez_joined, bbox = bbox_new) +\n  tm_fill(\"Percent suitable\", palette=\"BuPu\", style = \"equal\", n=6) +\n  tm_borders() +\n  tm_shape(CA) +\n  tm_borders() +\n  tm_shape(OR) +\n  tm_borders() +\n  tm_shape(WA) +\n  tm_borders() +\n  tm_compass(position = c(\"left\", \"bottom\")) +\n  tm_scale_bar(position = c(\"left\", \"bottom\")) +\n  tm_layout(title = \"Suitable area for oyster aquaculture\") +\n  tm_layout(legend.position = c(\"right\", \"center\")) +\n  tm_layout(inner.margins = 0.15)\ntmap_mode(\"plot\")\ntmap_arrange(total_area_map, percent_area_map)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Generalized suitability model\n\nNow that we have performed a suitability analysis for oysters in West Coast EEZs, we can broaden our workflow by building a function that provides us the same type of data visualizations for any species based on inputs of desired range for sea surface temperature and depth. We will first build our function and then test it out using suitability parameters for the Common carp.\n\n#### Build function\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reproducible workflow function for any species\nsuitable_aqua <- function(species, tempmin, tempmax, depthmin, depthmax) {\n  rcl_fun <- matrix(c(-Inf, tempmin, NA,\n                  tempmin, tempmax, 1,\n                  tempmax, Inf, NA), ncol = 3, byrow = TRUE)\n  sst_binary_fun <- reclassify(mean_sst, rcl = rcl_fun)\n  rcl_fun = matrix(c(-Inf, depthmin, NA,\n                 depthmin, depthmax, 1, \n                 depthmax, Inf, NA), ncol = 3, byrow = TRUE)\n  depth_binary_fun <- reclassify(depth, rcl = rcl_fun)\n  raster_mask_fun <- overlay(sst_binary_fun, depth_binary_fun, fun = '*')\n  raster_mask_fun <- crop(raster_mask_fun, eez)\n  if (all(unique(raster_mask_fun) %in% c(1, NA))) {\n  } else {stop(\"Error in code. Mask contains values other than 1 or NA.\")}\n  cell_areas_fun <- cellStats(raster_mask_fun, stat = \"sum\", na.rm = TRUE)\n  cell_areas_raster_fun <- raster(raster_mask_fun)\n  cell_areas_raster_fun[] <- cell_areas_fun\n  eez_raster_fun <- rasterize(eez, raster_mask_fun)\n  total_suitable_area_fun <- zonal(cell_areas_raster_fun, eez_raster_fun, fun = sum, na.rm = TRUE)\n  percent_suitable_area_fun <- (total_suitable_area_fun / eez$area_m2) * 100\n  eez_joined_fun <- cbind(eez, total_suitable_area_fun, percent_suitable_area_fun) %>%\n    mutate(\"Suitable area (km^2)\" = value / 1000000) %>%\n    mutate(\"Percent suitable\" = value.1) %>% \n    dplyr::select(-value, -value.1, -zone, -zone.1)\n  if (any(eez_joined_fun$`Percent suitable` < 0 | eez_joined_fun$`Percent suitable` > 100)) {\n    stop(\"Error in code. At least one percent area is not between 0 and 100.\")\n  } else {}\n  CA <- us_states %>%\n    filter(NAME == \"California\")\n  OR <- us_states %>%\n    filter(NAME == \"Oregon\")\n  WA <- us_states %>%\n    filter(NAME == \"Washington\")\n  bbox_new_fun <- st_bbox(eez)\n  xrange_fun <- bbox_new_fun$xmax - bbox_new_fun$xmin\n  bbox_new_fun[3] <- bbox_new_fun[3] + (0.9 * xrange_fun)\n  bbox_new_fun <- bbox_new_fun %>%\n    st_as_sfc()\n  total_area_map_fun <-\n    tm_shape(eez_joined_fun, bbox = bbox_new_fun) +\n    tm_fill(\"Suitable area (km^2)\", palette=\"Reds\", style = \"equal\", n=6) +\n    tm_borders() +\n    tm_shape(CA) +\n    tm_borders() +\n    tm_shape(OR) +\n    tm_borders() +\n    tm_shape(WA) +\n    tm_borders() +\n    tm_compass(position = c(\"left\", \"bottom\")) +\n    tm_scale_bar(position = c(\"left\", \"bottom\")) +\n    tm_layout(title = paste(\"Suitable area for\", species,\"aquaculture\")) +\n    tm_layout(legend.position = c(\"right\", \"center\")) +\n    tm_layout(inner.margins = 0.15)\n  percent_area_map_fun <- \n    tm_shape(eez_joined_fun, bbox = bbox_new_fun) +\n    tm_fill(\"Percent suitable\", palette=\"BuPu\", style = \"equal\", n=6) +\n    tm_borders() +\n    tm_shape(CA) +\n    tm_borders() +\n    tm_shape(OR) +\n    tm_borders() +\n    tm_shape(WA) +\n    tm_borders() +\n    tm_compass(position = c(\"left\", \"bottom\")) +\n    tm_scale_bar(position = c(\"left\", \"bottom\")) +\n    tm_layout(title = paste(\"Suitable area for\", species,\"aquaculture\")) +\n    tm_layout(legend.position = c(\"right\", \"center\")) +\n    tm_layout(inner.margins = 0.15)\n  return(tmap_arrange(total_area_map_fun, percent_area_map_fun))}\n```\n:::\n\n\n#### Use function to analyze suitable area for Common carp\n\nCompared to oysters, the Common carp can handle slightly more extreme temperatures (3 to 35 degrees Celsius) [@froese_fishbase_2023]. However, unlike oysters who thrive in depths of up to 70 meters below sea level, the Common carp can only handle up to 29 meters. We can apply our generalized function to see what this means in term of how suitability differs for the Common carp.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run function for Common carp species\nsuitable_aqua(\"Common carp\", tempmin=3, tempmax=35, depthmin=0, depthmax=29)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nThe two maps are very similar in terms of how the different EEZs compare to each other, but a closer inspection of the legend values does show us that the Common carp has a consistently higher amount of suitable area. Hence, the larger temperature range was more important for suitability than the narrower depth range.\n\n## Conclusion\n\nThe main takeaway from this analysis is that we were able to build a model that helps us better understand which West Coast EEZs are best suited for marine aquaculture of certain species based on ideal ranges for sea surface temperature and depth. To demonstrate how this model could be used, this analysis looked at suitability for oysters and the Common carp. Specifically, our comparison showed that having a larger temperature range (3-35 degrees Celsius for carp compared to 11-30 degrees Celsius for oysters) was more important for suitability than having a narrower depth range (0-29 meters for carp compared to 0-70 meters for oysters).\n\nThis being said, there are certainly limitations in using our model. For one, using a sea surface temperature raster with finer resolution would give us more precise estimates. In addition, this analysis did not look at where marine aquaculture currently exists on the West Coast. This model could be improved upon by subtracting areas that are already being used for marine aquaculture. Lastly, a more robust model would look at more variables than just sea surface temperature and depth. Further analysis might include additional water variables with conditional ranges for different species, such as degree hardness (dH) and potential of hydrogen (pH).\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
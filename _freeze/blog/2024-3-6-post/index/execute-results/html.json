{
  "hash": "945097c354931d0da950b427d07343f2",
  "result": {
    "markdown": "---\ntitle: \"Using statistical estimators with panel data to analyze the impact of a cash-transfer program\"\ndescription: \"For this analysis, I estimate the Average Treatment Effect (ATE) of the 1998 Prospera cash-transfer program on the value of animals owned by a household.\"\nauthor:\n  - name: Linus Ghanadan\n    url: https://linusghanadan.github.io/\n    affiliation: MEDS\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 03-06-2024\ncategories:\n  - [Statistical Modeling]\n  - [Causal Inference]\n  - [R]\nimage: did_estimator.jpeg\ncitation:\n  url: https://linusghanadan.github.io/blog/2024-3-6-post/\ndraft: false\nformat:\n    html:\n        code-fold: true\n---\n\n\n\n\n## [Link to GitHub repository](https://github.com/linusghanadan/cash-transfer-policy)\n\n## Question\n\nWhat was the average treatment effect (ATE) of the 1998 Progresa cash-transfer program on the value of animals owned by a household?\n\n## Background\n\nAccording to the [World Health Organization](https://www.ncbi.nlm.nih.gov/books/NBK258728/), cash-transfer programs are a form of social assistance assisting beneficiaries who are vulnerable to impoverishment without support. These programs assist beneficiaries through providing re-occurring cash payments, which can either be provided unconditionally or conditional to certain requirements (e.g., periodic health visits). Through boosting household income, the goal of cash-transfer programs is usually to improve the food security of families and provide them the resources to get medical care and prioritize childhood education.\n\n## Data\n\nOur data comes from a [2012 research paper published in the American Economic Journal](https://www.aeaweb.org/articles?id=10.1257/app.4.1.164) looking at the Progresa cash-transfer program, which was implemented in rural Mexican villages in 1998. Eligible households that were randomly selected to be part of the program were provided bi-monthly cash-transfers of up to 550 pesos per month. These cash-transfers were conditional on children attending school, family members obtaining preventive medical care, and attending health-related education talks. In total, over 17,000 households were part of the Progresa program.\n\n**The outcome and treatment variables are:**\n\n-   **vani** = value of animals owned by household (in 1997 USD)\n\n-   **treatment** = dummy variable indicating whether an individual was part of the cash-transfer program (equal to 1 if the individual was part of the program)\n\n**There are 55 control variables, including:**\n\n-   **dirtfloor97** = dummy variable indicating whether a household had a dirt floor in 1997\n\n-   **electricity97** = dummy variable indicating whether a household had electricity in 1997\n\n-   **homeown97** = dummy variable indicating whether a household owned a house in 1997\n\n-   **female_hh** = dummy variable indicating whether a household has a female head of household\n\n-   **age_hh** = head of household age\n\n-   **educ_hh** = head of household years of education\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import packages\nlibrary(tidyverse)\nlibrary(plm)\nlibrary(lmtest)\nlibrary(estimatr)\nlibrary(Hmisc)\nlibrary(RItools)\nlibrary(MatchIt)\nlibrary(knitr)\nlibrary(kableExtra)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Load the datasets\nprogresa_pre_1997 <- read_csv(here::here(\"data\", \"2024-3-6-post-data\", \"progresa_pre_1997.csv\"))\nprogresa_post_1999 <- read_csv(here::here(\"data\", \"2024-3-6-post-data\", \"progresa_post_1999.csv\"))\n\n## Append post to pre dataset \nprogresa <- rbind(progresa_pre_1997, progresa_post_1999)\n\n# Remove all families who were treated/controls in the program, but did not get measured in the second year\nprogresa <- progresa %>%\n  group_by(hhid) %>% filter(n() == 2) %>%\n  ungroup()\n```\n:::\n\n\n## Comparison of pre-treatment characteristics in the treatment and control groups\n\n#### Dirt floor in 1997 (dummy variable)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subset data for treatment and control groups\ntreatment_group <- progresa[progresa$treatment == 1, ]\ncontrol_group <- progresa[progresa$treatment == 0, ]\n\n# Compare proportion of units that had dirt floor in 1997 (binary variable) between treatment and control group\nprop.test(x = c(sum(treatment_group$dirtfloor97, na.rm = TRUE), sum(control_group$dirtfloor97, na.rm = TRUE)),\n          n <- c(length(treatment_group$dirtfloor97), length(control_group$dirtfloor97)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\t2-sample test for equality of proportions with continuity correction\n\ndata:  c(sum(treatment_group$dirtfloor97, na.rm = TRUE), sum(control_group$dirtfloor97, na.rm = TRUE)) out of n <- c(length(treatment_group$dirtfloor97), length(control_group$dirtfloor97))\nX-squared = 99.041, df = 1, p-value < 2.2e-16\nalternative hypothesis: two.sided\n95 percent confidence interval:\n 0.04486458 0.06704500\nsample estimates:\n   prop 1    prop 2 \n0.6394000 0.5834452 \n```\n:::\n:::\n\n\n#### Electricity in 1997 (dummy variable)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare proportion of units that had electricity in 1997 (binary variable) between treatment and control group\nprop.test(x = c(sum(treatment_group$electricity97, na.rm = TRUE), sum(control_group$electricity97, na.rm = TRUE)),\n          n <- c(length(treatment_group$electricity97), length(control_group$electricity97)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\t2-sample test for equality of proportions with continuity correction\n\ndata:  c(sum(treatment_group$electricity97, na.rm = TRUE), sum(control_group$electricity97, na.rm = TRUE)) out of n <- c(length(treatment_group$electricity97), length(control_group$electricity97))\nX-squared = 147.97, df = 1, p-value < 2.2e-16\nalternative hypothesis: two.sided\n95 percent confidence interval:\n -0.08027241 -0.05800589\nsample estimates:\n   prop 1    prop 2 \n0.5583031 0.6274422 \n```\n:::\n:::\n\n\n#### Owned home in 1997 (dummy variable)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare proportion of units that owned home in 1997 (binary variable) between treatment and control group\nprop.test(x = c(sum(treatment_group$homeown97, na.rm = TRUE), sum(control_group$homeown97, na.rm = TRUE)),\n          n <- c(length(treatment_group$homeown97), length(control_group$homeown97)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\t2-sample test for equality of proportions with continuity correction\n\ndata:  c(sum(treatment_group$homeown97, na.rm = TRUE), sum(control_group$homeown97, na.rm = TRUE)) out of n <- c(length(treatment_group$homeown97), length(control_group$homeown97))\nX-squared = 51.805, df = 1, p-value = 6.128e-13\nalternative hypothesis: two.sided\n95 percent confidence interval:\n 0.02251224 0.03967849\nsample estimates:\n   prop 1    prop 2 \n0.8460096 0.8149142 \n```\n:::\n:::\n\n\n#### Female head of house (dummy variable)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare proportion of units that had female head of house (binary variable) between treatment and control group\nprop.test(x = c(sum(treatment_group$female_hh, na.rm = TRUE), sum(control_group$female_hh, na.rm = TRUE)),\n          n <- c(length(treatment_group$female_hh), length(control_group$female_hh)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\t2-sample test for equality of proportions with continuity correction\n\ndata:  c(sum(treatment_group$female_hh, na.rm = TRUE), sum(control_group$female_hh, na.rm = TRUE)) out of n <- c(length(treatment_group$female_hh), length(control_group$female_hh))\nX-squared = 9.0087, df = 1, p-value = 0.002687\nalternative hypothesis: two.sided\n95 percent confidence interval:\n -0.016058579 -0.003296729\nsample estimates:\n    prop 1     prop 2 \n0.07980780 0.08948546 \n```\n:::\n:::\n\n\n#### Head of house age\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mean difference t-test for head of house age\nt.test(age_hh ~ treatment, data = progresa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  age_hh by treatment\nt = 12.657, df = 24438, p-value < 2.2e-16\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n 2.008817 2.744967\nsample estimates:\nmean in group 0 mean in group 1 \n       46.70221        44.32532 \n```\n:::\n:::\n\n\n#### Head of house years of education\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mean difference t-test for head of house years of education\nt.test(educ_hh ~ treatment, data = progresa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  educ_hh by treatment\nt = -1.2186, df = 25414, p-value = 0.223\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -0.10171053  0.02372436\nsample estimates:\nmean in group 0 mean in group 1 \n       2.658340        2.697333 \n```\n:::\n:::\n\n\n#### Findings\n\nFor several of the covariates, there are statistically significant differences between the pre-treatment characteristics of the treated and untreated groups. This indicates that there were likely systemic differences between the pre-treatment characteristics of individuals that were part of the cash-transfer program and those that were not, and if this is the case, simply controlling for all covariates is an insufficient method to estimate the ATE, since systemic differences means that there are differences between the groups that extend beyond what we can control for.\n\nBecause there seem to be systemic differences between the pre-treatment characteristics of the treated and untreated group, we will use more advanced techniques to estimate the ATE. Since we are working with panel data, our options for advanced techniques include the FD, FE, or DiD estimators.\n\n## Estimating ATE with the First-Difference (FD) estimator\n\nBecause a FD model controls for the differences in the explanatory variables between two time periods, the estimator is effective at removing bias from omitted variables that result from differences between time periods. If we think that the potential ommited variables (i.e., a variable that is influencing our outcome variable but is not included as a covariate) that are most important are likely to vary over different time periods, then using the FD estimator is the best approach for estimating ATE. For example, if the head of house having to deal with a family emergency was by far the most influential omitted variable, the FD estimator would likely be the best approach for estimating ATE, since having to deal with a family emergency is something that would likely vary over different time periods.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# i. Sort the panel data in the order in which you want to take differences, i.e. by household and time.\nprogresa_sorted <- progresa %>% \n  arrange(hhid, year) %>%\n  group_by(hhid) %>%\n  \n  # ii. Calculate the first difference using the lag function from the dplyr package.\n  mutate(vani_fd = vani - dplyr::lag(vani)) \n\n# iii. Estimate manual first-difference regression (Estimate the regression using the newly created variables.)\nfd_manual <- lm(vani_fd ~ treatment, data = progresa_sorted)\n\n# Extracting the coefficients table\nsummary_reg <- summary(fd_manual)\nsummary_reg$coefficients %>% \n  kbl(caption = \"FD estimator\") %>%  # Generate table\n  kable_classic(full_width = FALSE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n<caption>FD estimator</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -1156.752 </td>\n   <td style=\"text-align:right;\"> 64.4938 </td>\n   <td style=\"text-align:right;\"> -17.935859 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> treatment </td>\n   <td style=\"text-align:right;\"> 287.905 </td>\n   <td style=\"text-align:right;\"> 85.6020 </td>\n   <td style=\"text-align:right;\"> 3.363297 </td>\n   <td style=\"text-align:right;\"> 0.0007723 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nOur FD regression tells us that program participants experienced a change in the value of their animal holdings that was, on average, 287.90 dollars greater than the change experienced by non-participants from 1997 to 1999. Our standard error is 85.60 dollars, and our low p-value means we reject the null hypothesis that the difference is zero at an alpha level of 0.01.\n\n## Estimating ATE with the Fixed-Effects (FE) estimator\n\nA FE model directly controls for omitted variables that do no change over time, so the estimator is effective at removing bias that comes from time-invariant characteristics. If we think that the potential ommited variables (i.e., a variable that is influencing our outcome variable but is not included as a covariate) that are most important are likely stay constant over different time periods, then using the FE estimator is the best approach for estimating ATE. For example, if the head of house being an only child was by far the most influential omitted variable, the FE estimator would likely be the best approach for estimating ATE, since being an only child as an adult is unlikely to be something that would change over time periods.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ESTIMATE THE BASIC 'WITHIN' FIXED EFFECTS REGRESSION\n# NOTE \"plm\" ONLY PRODUCES CLUSTER-ROBUST STANDARD ERRORS\nwithin_reg <- plm(vani ~ treatment, index = c(\"state\", \"year\"), model = c(\"within\"), effect = c(\"twoways\"), data = progresa)\n\n# Extracting the coefficients table\nsummary_reg <- summary(within_reg)\nsummary_reg$coefficients %>% \n  kbl(caption = \"FE estimator\") %>%  # Generate table\n  kable_classic(full_width = FALSE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n<caption>FE estimator</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t-value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> treatment </td>\n   <td style=\"text-align:right;\"> -234.0142 </td>\n   <td style=\"text-align:right;\"> 56.65699 </td>\n   <td style=\"text-align:right;\"> -4.130368 </td>\n   <td style=\"text-align:right;\"> 3.63e-05 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nOur FE regression tells us that program participants experienced a change in the value of their animal holdings that was, on average, 234.01 dollars less than the change experienced by non-participants within each State from 1997 to 1999. Our cluster-standard error is 56.66 dollars, and our low p-value means we reject the null hypothesis that the difference is zero at an alpha level of \\<0.01. The standard error being cluster-robust means that it accounts for the fact that observations in the same State as one another will have results that are not entirely independent of one another.\n\n## Estimating ATE with the Difference-in-Difference (DiD) estimator\n\nIf we think that our omitted variables are likely to be a mix of variables that stay constant and change across time periods (and treatment occurs only at a single point in time), we are best off using the DiD estimator, which calculates ATE as the difference in the mean outcome variable in the treated group before and after the time of treatment minus the difference in the mean outcome variable in the untreated group before and after the time of treatment.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the dummy variables\nprogresa$treatment_dummy <- ifelse(progresa$treatment == 1, 1, 0)\nprogresa$post_treatment_time_dummy <- ifelse(progresa$year == 1999, 1, 0)\nprogresa$interaction_dummy <- progresa$treatment_dummy * progresa$post_treatment_time_dummy\n\n# OLS regression\nols_reg <- lm(vani ~ treatment_dummy + post_treatment_time_dummy + interaction_dummy, data = progresa)\n\n# Present Regressions in Table\nsummary_reg <- summary(ols_reg)\nsummary_reg$coefficients %>% \n  kbl(caption = \"DiD estimator\") %>%  # Generate table\n  kable_classic(full_width = FALSE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n<caption>DiD estimator</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 2848.2175 </td>\n   <td style=\"text-align:right;\"> 60.61455 </td>\n   <td style=\"text-align:right;\"> 46.989010 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> treatment_dummy </td>\n   <td style=\"text-align:right;\"> -237.6927 </td>\n   <td style=\"text-align:right;\"> 80.45311 </td>\n   <td style=\"text-align:right;\"> -2.954425 </td>\n   <td style=\"text-align:right;\"> 0.0031352 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> post_treatment_time_dummy </td>\n   <td style=\"text-align:right;\"> -1156.7517 </td>\n   <td style=\"text-align:right;\"> 85.72191 </td>\n   <td style=\"text-align:right;\"> -13.494235 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> interaction_dummy </td>\n   <td style=\"text-align:right;\"> 287.9050 </td>\n   <td style=\"text-align:right;\"> 113.77788 </td>\n   <td style=\"text-align:right;\"> 2.530413 </td>\n   <td style=\"text-align:right;\"> 0.0113985 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nFrom our regression, we estimate the average effect of the cash transfer program on value of animal holdings to be about 287.91 USD (where program participants had a higher average value of animal holdings at the end of the program), with a standard error of about 113.78 USD. To interpret this result as the ATE, we have to assume that the control group (units that did not participate in program) provides a valid counterfactual for what would have happened to units in our treatment group (program participants) had they not participated in the program. Furthermore, our p-value of 0.011 tells us that, at an alpha level of 0.05, we reject the null hypothesis that there was no average effect of the cash transfer program on value of animal holdings.\n\nThe coefficient on our treatment dummy variable tells us that we estimate the mean difference in the outcome variable (value of animal holdings) between the treatment group (program participants) and the control group (non-participants) before the program started to have been 237.69 USD (where program participants had a lower average value of animal holdings than non-participants prior to the start of the program), with a standard error of 80.45 USD. Our p-value of \\<0.01 tells us that, at an alpha level of 0.01, we reject the null hypothesis that there was a mean difference of zero.\n\nThe coefficient on our post treatment time dummy variable tells us that we estimate the mean change in the outcome variable (value of animal holdings) between the beginning and end of the program for the control group (non-participants in program) to be 1,156.75 USD (where non-participants had a lower average value of animal holdings when the program ended than when it started), with a standard error of 85.72 USD. Our p-value of 0.003 tells us that, at an alpha level of 0.01, we reject the null hypothesis that there was a mean change of zero.\n\n## Conclusion\n\nOverall, the cash-transfer program appears to have been quite successful at boosting the value of animals owned by a household. In this cash-transfer program, all treatment occurred at the same time and we expect our omitted variables to be a mix of variable that change and stay constant across time periods, so the DiD estimator is likely the best method for estimating ATE in our situation. Using the DiD estimator, we estimated the average effect of the cash transfer program on value of animal holdings to be about 287.91 USD (where program participants had a higher average value of animal holdings at the end of the program), with a standard error of about 113.78 USD. For this to be interpreted as the ATE, we have to assume that the control group (units that did not participate in program) provides a valid counterfactual for what would have happened to units in our treatment group (program participants) had they not participated in the program.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
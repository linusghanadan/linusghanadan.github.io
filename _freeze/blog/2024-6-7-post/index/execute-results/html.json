{
  "hash": "1aeed0a44f4d0a5e6d082459714ec4ea",
  "result": {
    "markdown": "---\ntitle: \"Global sensitivity analysis for an atmospheric conductance model\"\ndescription: \"In this analysis, I look at an atmospheric conductance model based on vegetation height and windspeed, and I apply a variance-based sensitivity analysis by calculating Sobol indices.\"\nauthor: \n  - name: Linus Ghanadan\n    url: https://linusghanadan.github.io/\n    affiliation: MEDS\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 06-07-2024\ncategories:\n  - [Sensitivity Analysis]\n  - [R]\nimage: download_sobol.jpeg\ncitation:\n  url: https://linusghanadan.github.io/blog/2024-6-7-post/\ndraft: false\nformat:\n    html:\n        code-fold: false\n---\n\n\n## [Link to GitHub repository](https://github.com/linusghanadan/atmospheric-conductance-sobol)\n\n## Setup\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(sensitivity)\nlibrary(tidyverse)\nlibrary(purrr)\nlibrary(ggpubr)\n```\n:::\n\n\n## Source atmospheric conductance function\n\nFor the purposes of showing the complete documentation for the function that I am working with, I have included the full contents of the R script that was sourced when I originally conducted this analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#' Compute Atmospheric Conductance\n#'\n#' This function atmospheric conductance as a function of windspeed, and vegetation cahracteristics\n#' @param       v windspeed (m/s)\n#' @param      height vegetation height (m)\n#' @param       zm measurement height of wind (m) (default 2m)\n#' @param      k_o scalar for roughness (default 0.1)\n#' @param      k_d scalar for zero plane displacement (default 0.7)\n#' @author Naomi\n#'\n#' @return  Conductance (mm/s)\n\nCatm = function(v, height, k_o=0.1, k_d=0.7) {\n\n    zm_add = 2\n  \n    zd = k_d*height\n    zo = k_o*height\n\n    zm = height+zm_add\n\n    zd = ifelse(zd < 0, 0, zd)\n    Ca = ifelse(zo > 0,\n     v / (6.25*log((zm-zd)/zo)**2),0)\n\n# convert to mm\n    Ca = Ca*1000\n   return(Ca)\n}\n```\n:::\n\n\n## Generate input/parameter values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n\n# generate input/parameter samples\nnp <- 1000\nk_o <- rnorm(np, mean=0.1, sd=0.1*0.1)\nk_d <- rnorm(np, mean=0.7, sd=0.7*0.1)\nv <- rnorm(np, mean=300, sd=50)\nheight <- runif(np, min=3.5, max=5.5)\n\nX1 <- cbind.data.frame(k_o, k_d, v, height=height)\n\n# generate another set of input/parameter samples\nk_o <- rnorm(np, mean=0.1, sd=0.1*0.1)\nk_d <- rnorm(np, mean=0.7, sd=0.7*0.1)\nv <- rnorm(np, mean=300, sd=50)\nheight <- runif(np, min=3.5, max=5.5)\n\nX2 <- cbind.data.frame(k_o, k_d, v, height=height)\n```\n:::\n\n\n## Run atmospheric conductance model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use Jansen approach implemented by sobolSalt\nsens_Catm_Sobol <- sobolSalt(model = NULL, X1, X2, nboot = 100)\n\n# define input/parameters\nparms <- as.data.frame(sens_Catm_Sobol$X)\ncolnames(parms) <- colnames(X1)\n\n# run the model\nres = pmap_dbl(parms, Catm)\n\n# update the sensitivity analysis object with the results\nsens_Catm_Sobol <- sensitivity::tell(sens_Catm_Sobol, res, res.names = \"ga\")\n```\n:::\n\n\n## Plot conductance estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot distribution of conductance estimates\nggplot(data = data.frame(Ca = res), aes(x = Ca)) +\n  geom_density(fill=\"cornflowerblue\", alpha=0.5) +\n  labs(title = \"Conductance Estimates\", x = \"Conductance (mm/s)\", y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Plot total sensitivity indices of all inputs/parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate total sensitivity indices\ntotal_sensitivity <- apply(sens_Catm_Sobol$T, 1, mean)\n\n# plot total sensitivity indices to identify second most influential parameter\nsensitivity_df <- data.frame(\n  Parameters = colnames(X1),\n  TotalEffect = total_sensitivity\n)\nggplot(sensitivity_df, aes(x = Parameters, y = TotalEffect)) +\n  geom_bar(stat = \"identity\", fill = \"darkseagreen\") +\n  labs(title = \"Total Sensitivity Indices\", y = \"Total Effect\", x = \"Parameters\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Plot conductance against two most sensitive inputs/parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot two most sensitive inputs/parameters\nboth = cbind.data.frame(parms, gs=sens_Catm_Sobol$y)\nggplot(both, aes(v,gs, col=k_o))+geom_point()+labs(y=\"Conductance (mm/s)\", x=\"Windspeed (cm/s)\", title=\"Global Sensitivity Analysis: Impact of Windspeed and k_o on Conductance\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Estimate Sobol indices\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add parameter names to main effect and total sensitivity indices\nrow.names(sens_Catm_Sobol$S) = colnames(parms)\nrow.names(sens_Catm_Sobol$T) = colnames(parms)\n\n# print all sobol indices\nprint(sens_Catm_Sobol)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nsobolSalt(model = NULL, X1 = X1, X2 = X2, nboot = 100)\n\nModel runs: 6000 \n\nModel variance: 8417654 \n\nFirst order indices:\n        original          bias std. error  min. c.i. max. c.i.\nk_o    0.2093548  0.0002043903 0.03498043 0.14767984 0.2931129\nk_d    0.1993786  0.0042697793 0.03682199 0.12276724 0.2778684\nv      0.4753836 -0.0016100511 0.02071453 0.44440102 0.5241987\nheight 0.1043329  0.0003478314 0.03216599 0.03546999 0.1750344\n\nTotal indices:\n        original          bias  std. error min. c.i. max. c.i.\nk_o    0.1690400  0.0004720644 0.010837170 0.1477810 0.1895922\nk_d    0.1646352  0.0005778152 0.010384375 0.1446359 0.1836950\nv      0.5199054 -0.0007921543 0.027909766 0.4669257 0.5705891\nheight 0.1276424  0.0003586299 0.007147771 0.1114200 0.1406503\n```\n:::\n:::\n\n\n## Conclusion\n\nIn this setting (compared to the setting looked at in class), windspeed was higher and less variable, while vegetation was shorter. Comparing the two sensitivity analyses, we can see that these differences in conditions was associated with a decrease in model variance, as the model variance determined here (\\~8.4 million) was less than half the variance we found in class (\\~19.7 million). In addition, for the model we look at here, the total sensitivity index for k_d is significantly lower, while that for k_o, windspeed, and height are significantly higher. Because the total sensitivity index for windspeed is significantly higher, this tells us that atmospheric conductance is more sensitive to windspeed in areas where windspeed is high and less variable and vegetation is shorter. However, the lower model variance tells us that overall, atmospheric conductance has less variation in these conditions.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}